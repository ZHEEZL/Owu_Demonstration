{% extends "base.html" %}

{% block content %}
<h1>Upload Video</h1>
<form id="upload-form" action="{{ url_for('upload') }}" method="post" enctype="multipart/form-data">
    <label for="title">Title:</label>
    <input type="text" name="title" id="title" required>

    <label for="description">Description:</label>
    <textarea name="description" id="description" rows="4" placeholder="Enter video description..." required></textarea>

    <label for="video">Select video:</label>
    <input type="file" name="video" id="video" accept="video/*" required>

    <label for="thumbnail">Select thumbnail (optional):</label>
    <input type="file" name="thumbnail" id="thumbnail" accept="image/*">

    <progress id="progress-bar" value="0" max="100" style="width: 100%; display: none;"></progress>

    <button type="submit">Upload</button>
</form>

<script>
    document.getElementById('upload-form').addEventListener('submit', function(event) {
        event.preventDefault(); // Предотвращаем обычную отправку формы

        const form = event.target;
        const formData = new FormData(form);
        const progressBar = document.getElementById('progress-bar');
        progressBar.style.display = 'block'; // Показать прогресс-бар

        const xhr = new XMLHttpRequest();
        xhr.open('POST', form.action, true);

        xhr.upload.addEventListener('progress', function(e) {
            if (e.lengthComputable) {
                const percentComplete = (e.loaded / e.total) * 100;
                progressBar.value = percentComplete;
            }
        });

        xhr.onload = function() {
            if (xhr.status === 200) {
                alert('Upload successful!');
                window.location.href = "{{ url_for('home') }}"; // Перенаправление на главную после успешной загрузки
            } else {
                alert('Upload failed!');
            }
        };

        xhr.onerror = function() {
            alert('Upload failed!');
        };

        xhr.send(formData);
    });
</script>
{% endblock %}
